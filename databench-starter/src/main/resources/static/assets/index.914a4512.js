var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,o,n)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,i=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&r(e,o,t[o]);if(n)for(var o of n(t))a.call(t,o)&&r(e,o,t[o]);return e},c=(e,n)=>t(e,o(n));import{c as l,R as d,u,l as f,o as m,a as b,b as p,d as h,e as y,m as T,r as g,f as w,P as E,H as I,g as L}from"./vendor.144db54d.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const _={},k=function(e,t){return t&&0!==t.length?Promise.all(t.map((e=>{if((e=`/${e}`)in _)return;_[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script",n.crossOrigin=""),n.href=e,document.head.appendChild(n),t?new Promise(((e,t)=>{n.addEventListener("load",e),n.addEventListener("error",t)})):void 0}))).then((()=>e())):e()};const j=e=>{const t=e,{className:o,size:r,color:u,href:f,link:m,disabled:b,children:p}=t,h=((e,t)=>{var o={};for(var r in e)s.call(e,r)&&t.indexOf(r)<0&&(o[r]=e[r]);if(null!=e&&n)for(var r of n(e))t.indexOf(r)<0&&a.call(e,r)&&(o[r]=e[r]);return o})(t,["className","size","color","href","link","disabled","children"]),y=l("btn",u?"color":"",m?"link":"button",o,{[`btn-${u}`]:u,disabled:b,[`btn-${r}`]:r});return m?d.createElement("a",i({className:y,href:f},h),p):d.createElement("button",c(i({disabled:b},h),{className:y}),p)},v=[{path:"/uiTest",name:"UI测试页面"},{path:"/workspace",name:"Visual Databench大数据工作台"}];const D=[{path:"/",exact:!0,component:d.memo((()=>{const e=u();return d.createElement("div",{className:" p-25"},d.createElement("div",{className:" text-2xl mb-20"},"首页"),v.map((t=>d.createElement(j,{key:t.name,className:"mr-10",onClick:()=>e.push({pathname:t.path})},t.name))))}))},{path:"/workspace",exact:!0,component:f((()=>k((()=>import("./index.cdfd7cc0.js")),["assets/index.cdfd7cc0.js","assets/vendor.144db54d.js"])))},{path:"/databench",exact:!0,component:f((()=>k((()=>import("./index.9266bdc9.js").then((function(e){return e.i}))),["assets/index.9266bdc9.js","assets/index.b7d72f44.css","assets/vendor.144db54d.js"])))},{path:"/uiTest",exact:!0,component:f((()=>k((()=>import("./index.3766833c.js")),["assets/index.3766833c.js","assets/vendor.144db54d.js"])))},{path:"/test",exact:!0,component:f((()=>k((()=>import("./index.8cf2db4f.js")),["assets/index.8cf2db4f.js","assets/vendor.144db54d.js"])))}],O=(e,t)=>{let o=i({},e);return t(o),o},S=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},P=(e,t)=>{const o=localStorage.getItem(e);return void 0===o||null==o?t:JSON.parse(o)};let $=0;const F=e=>{$+=1,setTimeout((()=>{$>0&&e(2==$),$=0}),200)};var x=m.array(P("___tabs_caches",[]),{deep:!0}),K=m(P("___ui_setting",{theme:"dark",curTabKey:"",windowFooterSplitSize:360,windowFooterVsible:!0}));const z=b((()=>K.windowFooterVsible=!K.windowFooterVsible)),N=b((e=>{K.windowFooterVsible=e})),C=b((e=>{K.windowFooterFull=e})),G=b((e=>K.windowFooterSplitSize=e));p((()=>{var e,t;S("___tabs_caches",x),S("___ui_setting",K),"dark"===K.theme?null==(e=document.querySelector("html"))||e.classList.add("dark"):null==(t=document.querySelector("html"))||t.classList.remove("dark")}));const R=b((()=>{K.theme="dark"===K.theme?"light":"dark"})),V=e=>x.find((t=>t.key===e)),W=e=>x.findIndex((t=>t.key===e)),q=b((e=>{const{key:t,tmp:o}=e;let n=V(t);const s=x.findIndex((e=>e.tmp));n?(x.forEach((e=>{e.key===t&&Object.assign(e,n)})),K.curTabKey===t?o||(n.tmp=!1):H(t)):-1!==s?(x[s]=e,H(t)):(x.splice(W(K.curTabKey)+1,0,e),H(t))})),H=b((e=>{K.curTabKey=e})),U=b((e=>{var t;const o=W(e);if(-1!==o&&(x.splice(o,1),e===K.curTabKey)){const e=o<x.length?o:o-1;-1!==e&&H(null==(t=x[e])?void 0:t.key)}})),A=b((()=>{x.splice(0,x.length),K.curTabKey=""})),J=b((e=>{const t=W(e);x.splice(0,t),x.splice(1,x.length-1),e!==K.curTabKey&&H(e)})),B=b((e=>{x.splice(W(e)+1,x.length),e!==K.curTabKey&&H(e)})),M=b((()=>{x.filter((e=>!e.changed)).forEach((e=>{x.splice(W(e.key),1)})),!x.map((e=>e.key)).includes(K.curTabKey)&&x.length>0&&H(x[0].key)})),Q=b((e=>{x.forEach((t=>{t.key===e&&(t.tmp=!1)}))})),X=b(((e,t)=>{const o=V(e);o&&(o.changed=t,t&&(o.tmp=!1))}));var Y={tabs:x,addTab:q,changeTab:H,closeTab:U,closeAllTabs:A,closeOtherTabs:J,closeToTheRightTabs:B,closeSavedTabs:M,keepTabOpen:Q,getTab:V,setTabChange:X,curTab:h((()=>V(K.curTabKey))),uiSetting:K,toggleTheme:R,toggleWindowFooterVisible:z,changeWindowFooterSplitSize:G,setWindowFooterVisible:N,setWindowFooterFull:C};const Z=y.create({baseURL:"/api",timeout:6e4}),ee=async e=>new Promise(((t,o)=>(async e=>{try{const{data:t}=await Z.request(e);return t}catch(t){return{errorCdoe:-1,msg:t.message||"Request error",data:null,success:!1}}})(e).then((e=>{e.success?t(e.data):(T.error(e.msg),o(e.msg))}))));var te={GET:async e=>ee({url:e,method:"GET"}),POST:async(e,t,o)=>ee(i({url:e,method:"POST",data:t},o)),PUT:async(e,t,o)=>ee(i({url:e,method:"PUT",data:t},o)),DELETE:async(e,t)=>ee(i({url:e,method:"DELETE"},t))};const oe=(e,t,o)=>te.GET(`/tree?workspaceId=${e}&bizId=${o}&moduleType=${t}`),ne=e=>te.GET(`/biz/graph?bizId=${e}`),se=()=>te.GET("/node/output"),ae=(e,t)=>te.POST("/file/commit?",{fileId:e,comment:t});const re=e=>te.POST("/folder",e),ie=e=>te.POST("/file",e),ce=e=>te.PUT("/folder",e),le=e=>te.PUT("/file",e),de=e=>te.DELETE(`/file/${e}`),ue=e=>te.DELETE(`/folder/${e}`),fe=(e,t,o,n)=>{let s=`/file/list?workspaceId=${e}&bizId=${t}&moduleType=${o}`;return n&&(s+=`&fileType=${n}`),te.GET(s)},me=(e,t)=>te.POST(`/file/run?fileId=${e}`,t),be=e=>te.POST(`/console/checkDone?jobId=${e}`),pe=e=>e.startsWith("file_"),he=e=>e.startsWith("category_"),ye=e=>e.startsWith("biz_"),Te=e=>{if(ye(e))return Number(e.split("_")[1])},ge=e=>{if(pe(e))return Number(e.substring(5,e.length))},we=m({id:0,name:"测试空间",description:"",fileList:[],consoleDataList:[]}),Ee=b((async e=>{const t=await(e=>te.GET(`/workspace?name=${e}`))(e);return g((()=>{Object.assign(we,t)})),t})),Ie=b((async()=>{const e=we.id;let t=await(e=>te.GET(`/biz/list?workspaceId=${e}`))(e);const o=t.map((t=>oe(e,"development",t.id)));return Promise.all(o).then((e=>{e.forEach(((e,o)=>{t[o].bizTreeData=e})),g((()=>{we.bizList=t}))}))})),Le=b((async e=>{const t=await(e=>te.GET(`/file?fileId=${e}`))(e),o=we.fileList.findIndex((t=>t.id===e)),n=c(i({},t),{content:i({},t.content),cfg:i({},t.cfg),id:e});return g((()=>{-1===o?we.fileList.push(n):we.fileList.splice(o,1,n)})),n})),_e=b((async()=>{const e=await oe(we.id,"query",-1);return g((()=>{we.tmpQueryTreeData=e})),e})),ke=b((async()=>{const e=await oe(we.id,"resource",-1);return g((()=>{we.resourceTreeData=e})),e})),je=b((async()=>{const e=await oe(we.id,"document",-1);return g((()=>{we.documentTreeData=e})),e})),ve=b((async()=>{const e=await oe(we.id,"component",-1);return g((()=>{we.componentTreeData=e})),e})),De=b((async()=>{const e=await(t=we.id,te.GET(`/file/deleteList?workspaceId=${t}`));var t;return g((()=>{we.deleteFileList=e.map((e=>c(i({},e),{folderId:0})))})),e})),Oe=(e,t)=>{for(const o in we.fileList){const n=we.fileList[o];if(n.id===e)return t(n),n}},Se=b((e=>{const t=Oe(e,(e=>{}));return t&&(e=>te.PUT("/file/detail",e))(t).then((()=>{T.success("保存成功!")}))})),Pe=b((async e=>{const t=await function(e){return te.GET(`/file/commit/list?fileId=${e}`)}(e);return t.sort(((e,t)=>t.version-e.version)),g((()=>{Oe(e,(e=>e.commitRecords=t))})),t})),$e=b((async(e,t=1,o=10)=>{if(1==t){const t=we.consoleDataList.findIndex((t=>t.winTabKey===e));-1!==t&&we.consoleDataList.splice(t,1),we.consoleDataList.push({winTabKey:e,jobId:void 0,jobHistoryList:[]})}const n=await(s={pageNum:t,pageSize:o,filter:{fileId:ge(e),workspaceId:we.id,bizId:Te(e)}},te.POST("/console/jobHistory/page",s));var s;we.consoleDataList.forEach((t=>{t.winTabKey==e&&g((()=>{const e=n.data;t.jobHistoryList=e,e.length>0&&(t.jobId=e[0].jobId)}))}))})),Fe=(e,t,o)=>{we.consoleDataList.forEach((n=>{n.winTabKey===e&&n.jobHistoryList.forEach((e=>{e.jobId===t&&o(e)}))}))},xe=b((async(e,t)=>{Fe(e,t,(async o=>{o.log||(o.log={jobId:t,lines:[],done:!1,offset:0,length:100});const n=o.log,s=await((e,t,o)=>te.GET(`/console/log?jobId=${e}&offset=${t}&length=${o}`))(t,n.offset,n.length);g((async()=>{Fe(e,t,(e=>{let o=e.log;e.jobId===t&&(o.done=s.done,o.lines=o.lines.concat(s.lines),o.offset=o.offset+=s.lines.length)}))}))}))})),Ke=b((async(e,t)=>{Fe(e,t,(async e=>{if(e.done){const o=await(e=>te.GET(`/console/queryResult?jobId=${e}`))(t);g((()=>{e.result=o}))}}))})),ze=b((async(e,t)=>{Fe(e,t,(async e=>{let o=e.done;o||(o=await be(t),g((()=>{e.done=o})),o&&(e=>te.GET(`/console/jobHistory?jobId=${e}`))(t).then((t=>{g((()=>{Object.assign(e,t)}))})))}))})),Ne=b((async(e,t)=>{var o;if(void 0===(t=t||(null==(o=we.consoleDataList.find((t=>t.winTabKey===e)))?void 0:o.jobId)))return;let n=t;Fe(e,t,(async e=>{await(e=>te.POST(`/console/cancel/${e}`))(n)&&be(n).then((e=>{e&&T.success("取消成功！")}))}))}));var Ce={BenchStore:{uiStore:Y,dataStore:{workspaceData:we,fetchWorkspace:Ee,fetchBizList:Ie,fetchFileDetail:Le,fetchTempQueryTreeData:_e,fetchResourceTreeData:ke,fetchDocumentTreeData:je,fetchComponentTreeData:ve,fetchDeleteFileList:De,fetchCommitRecords:Pe,saveFile:Se,changeFileContent:b(((e,t)=>{Oe(e,(e=>t(e.content)))})),changeFileCfg:b(((e,t)=>{Oe(e,(e=>t(e.cfg)))})),fetchJobHistoryList:$e,changeConsoleJobId:b(((e,t)=>{const o=we.consoleDataList.find((t=>t.winTabKey===e));o&&(o.jobId=t)})),fetchConsoleLog:xe,fetchConsoleResult:Ke,cancelConsoleJob:Ne,checkConsoleJobDone:ze,isConsoleRun:e=>we.consoleDataList.filter((t=>t.winTabKey===e&&t.jobHistoryList.filter((e=>e.jobId===t.jobId&&!e.done)).length>0)).length>0}}};w.render(d.createElement(d.StrictMode,null,d.createElement(E,{stores:Ce},d.createElement(I,null,L(D)))),document.getElementById("root"));export{j as B,pe as a,de as b,F as c,ue as d,re as e,ie as f,le as g,ne as h,he as i,fe as j,se as k,me as l,ce as m,O as n,ae as o,ye as p,te as r};
//# sourceMappingURL=index.914a4512.js.map
